Command: ./runner.sh nnar_income.py
Directory: 
Date: seg nov 11 01:00:44 -03 2019
Current commit: e3f9acb337c5c2554272bfbe5557c4ea5b0f6295
Diff to commit: diff --git a/.gitignore b/.gitignore
index 0f68eb7..89de09e 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,5 +1,5 @@
 .ipynb_checkpoints/
-.db
+*.db
 venv/
 __pycache__/
 .vscode/settings.json
\ No newline at end of file
diff --git a/income/adult.data b/income/adult.data
index 076a730..b29f8b2 100644
--- a/income/adult.data
+++ b/income/adult.data
@@ -32559,5 +32559,4 @@ age,workclass,fnlwgt,education,education_num,marital_status,occupation,relations
 40,Private,154374,HS-grad,9,Married-civ-spouse,Machine-op-inspct,Husband,White,Male,0,0,40,United-States,>50K
 58,Private,151910,HS-grad,9,Widowed,Adm-clerical,Unmarried,White,Female,0,0,40,United-States,<=50K
 22,Private,201490,HS-grad,9,Never-married,Adm-clerical,Own-child,White,Male,0,0,20,United-States,<=50K
-52,Self-emp-inc,287927,HS-grad,9,Married-civ-spouse,Exec-managerial,Wife,White,Female,15024,0,40,United-States,>50K
-
+52,Self-emp-inc,287927,HS-grad,9,Married-civ-spouse,Exec-managerial,Wife,White,Female,15024,0,40,United-States,>50K
\ No newline at end of file
diff --git a/income/adult.test b/income/adult.test
index 7e4838f..6d9f5fd 100644
--- a/income/adult.test
+++ b/income/adult.test
@@ -16279,5 +16279,4 @@ age,workclass,fnlwgt,education,education_num,marital_status,occupation,relations
 64,?,321403,HS-grad,9,Widowed,?,Other-relative,Black,Male,0,0,40,United-States,<=50K
 38,Private,374983,Bachelors,13,Married-civ-spouse,Prof-specialty,Husband,White,Male,0,0,50,United-States,<=50K
 44,Private,83891,Bachelors,13,Divorced,Adm-clerical,Own-child,Asian-Pac-Islander,Male,5455,0,40,United-States,<=50K
-35,Self-emp-inc,182148,Bachelors,13,Married-civ-spouse,Exec-managerial,Husband,White,Male,0,0,60,United-States,>50K
-
+35,Self-emp-inc,182148,Bachelors,13,Married-civ-spouse,Exec-managerial,Husband,White,Male,0,0,60,United-States,>50K
\ No newline at end of file
diff --git a/nar_heatmap.py b/nar_heatmap.py
index e7ba686..39b309f 100644
--- a/nar_heatmap.py
+++ b/nar_heatmap.py
@@ -21,7 +21,7 @@ baseline = 1 - np.array([[0.8335892 , 0.83143997, 0.82591343, 0.8038072 , 0.8038
        [0.65213388, 0.71139085, 0.79244703, 0.7740252 , 0.77463925,
         0.75683147],
        [0.46576604, 0.4009825 , 0.49554804, 0.61743939, 0.45716918,
-        0.49831134]])
+        0.49831134]]).T
 forward = 1 - np.array([[0.83850169, 0.83297515, 0.83451027, 0.83236104, 0.83727354,
         0.83143997],
        [0.83850169, 0.83236104, 0.83481729, 0.8305189 , 0.82407123,
@@ -33,7 +33,7 @@ forward = 1 - np.array([[0.83850169, 0.83297515, 0.83451027, 0.83236104, 0.83727
        [0.82591343, 0.83481729, 0.82345718, 0.82407123, 0.79275405,
         0.76020879],
        [0.82345718, 0.83205402, 0.81823766, 0.81793064, 0.74762052,
-        0.44273871]])
+        0.44273871]]).T
 backward = 1 - np.array([[0.83573842, 0.83635247, 0.83082592, 0.83727354, 0.8286767 ,
         0.82468528],
        [0.83389622, 0.83880872, 0.82714152, 0.83573842, 0.82898372,
@@ -45,7 +45,7 @@ backward = 1 - np.array([[0.83573842, 0.83635247, 0.83082592, 0.83727354, 0.8286
        [0.83113295, 0.82929075, 0.82806265, 0.82775563, 0.7988947 ,
         0.80718452],
        [0.83021188, 0.8305189 , 0.83297515, 0.80810565, 0.74669939,
-        0.59134173]])
+        0.59134173]]).T
 
 #%%
 
diff --git a/nar_income.py b/nar_income.py
index 22cb353..da5ddd0 100644
--- a/nar_income.py
+++ b/nar_income.py
@@ -15,15 +15,12 @@ os.environ["CUDA_VISIBLE_DEVICES"]="0"
 # importing tf and keras
 import tensorflow as tf
 from tensorflow import keras
-from keras.utils import to_categorical
-from keras.backend import dot, transpose, categorical_crossentropy
+from tensorflow.keras.utils import to_categorical
+from tensorflow.keras.backend import dot, transpose, categorical_crossentropy
 
 #%% seeding random
-
-from numpy.random import seed
-seed(1)
-from tensorflow import set_random_seed
-set_random_seed(1)
+np.random.seed(77)
+tf.random.set_seed(77)
 
 #%% specifying model
 
diff --git a/nnar_income estimation.py b/nnar_income estimation.py
index acb91a3..d5b0ef1 100644
--- a/nnar_income estimation.py	
+++ b/nnar_income estimation.py	
@@ -70,10 +70,10 @@ def pollute(data, sex, T_male, T_female):
 #%% polluting data 
 
 
-fp_female = 0.4
-fn_female = 0.4
-fp_male = 0.4
-fn_male = 0.4
+fp_female = 0.0
+fn_female = 0.0
+fp_male = 0.0
+fn_male = 0.0
         
 T_male = np.array([[1-fp_male, fp_male],
                 [ fn_male , 1-fn_male]]).astype(np.float32)
diff --git a/nnar_income.py b/nnar_income.py
index 4c8db31..8a1b393 100644
--- a/nnar_income.py
+++ b/nnar_income.py
@@ -106,7 +106,7 @@ class Evaluater(object):
                             X_test, y_test,\
                             fp_male, fn_male, fp_female, fn_female,\
                             training_epochs):
-        logging.info("[%.1f,%.1f,%.1f,%.1f] I am alive! " % (fp_male, fn_male, fp_female, fn_female) )    
+        logging.info("[%.2f,%.2f,%.2f,%.2f] I am alive! " % (fp_male, fn_male, fp_female, fn_female) )    
                              
         self.directory = directory
         self.training_epochs = training_epochs
@@ -129,8 +129,11 @@ class Evaluater(object):
         self.T_female = np.array([[1-fp_female, fp_female],
                             [ fn_female , 1-fn_female]]).astype(np.float32)
 
-        self.polluted_male_labels = pollute(self.y_train_male, self.T_male)
-        self.polluted_female_labels = pollute(self.y_train_female, self.T_female)
+        self.fixed_pollution = np.array([[1-0.25, 0.25],
+                                        [ 0.25 , 1-25]]).astype(np.float32)
+
+        self.polluted_male_labels = pollute(self.y_train_male, self.fixed_pollution)
+        self.polluted_female_labels = pollute(self.y_train_female, self.fixed_pollution)
 
         self.X_train = np.vstack([self.X_train_male, self.X_train_female])
         self.y_train = np.vstack([self.y_train_male, self.y_train_female])
@@ -140,9 +143,9 @@ class Evaluater(object):
         female_loss = forward_categorical_crossentropy(self.T_female)
         
         # testing without correction
-        test_loss, test_acc, test_pred = self.baseline()
-        self.baseline_result = [test_loss, test_acc]
-        self.baseline_pred = test_pred
+        #test_loss, test_acc, test_pred = self.baseline()
+        #self.baseline_result = [test_loss, test_acc]
+        #self.baseline_pred = test_pred
         #logging.info("[%.1f,%.1f,%.1f,%.1f] Baseline: %f" % (self.fp_male, self.fn_male, self.fp_female, self.fn_female, test_acc))
         
         # polluted data with two step forward
@@ -158,14 +161,14 @@ class Evaluater(object):
         #logging.info("[%.1f,%.1f,%.1f,%.1f] Alternating forward: %f" % (self.fp_male, self.fn_male, self.fp_female, self.fn_female, test_acc) )
         self.persist_results()
         
-        logging.info("[%.1f,%.1f,%.1f,%.1f] I am done! " % (fp_male, fn_male, fp_female, fn_female) )
+        logging.info("[%.2f,%.2f,%.2f,%.2f] I am done! " % (fp_male, fn_male, fp_female, fn_female) )
         del self
     
     def persist_results(self):
-        db_path = os.path.join(self.directory, "baseline.db")
-        conn = persistence.create_connection(db_path)
-        with conn:
-            persistence.persist_nnar(conn, "result", self.error_rates + self.baseline_result, self.baseline_pred)
+        #db_path = os.path.join(self.directory, "baseline.db")
+        #conn = persistence.create_connection(db_path)
+        #with conn:
+        #    persistence.persist_nnar(conn, "result", self.error_rates + self.baseline_result, self.baseline_pred)
         
         db_path = os.path.join(self.directory, "two_step_forward.db")
         conn = persistence.create_connection(db_path)
@@ -323,14 +326,11 @@ def main():
     log_path = os.path.join(directory, "nohup.out")
     logging.basicConfig(filename=log_path,level=logging.DEBUG)
     
-    db_path = os.path.join(directory, "baseline.db")
-    conn = persistence.create_connection(db_path)
-
     # create sqlite tables
-    db_path = os.path.join(directory, "baseline.db")
-    conn = persistence.create_connection(db_path)
-    with conn:
-        persistence.create_nnar_table(conn, "result")
+    #db_path = os.path.join(directory, "baseline.db")
+    #conn = persistence.create_connection(db_path)
+    #with conn:
+    #    persistence.create_nnar_table(conn, "result")
     
     db_path = os.path.join(directory, "two_step_forward.db")
     conn = persistence.create_connection(db_path)
@@ -342,10 +342,10 @@ def main():
     with conn:
         persistence.create_nnar_table(conn, "result")
 
-    fps_male = [0, 0.1, 0.2, 0.3, 0.4, 0.5]
-    fns_male = [0, 0.1, 0.2, 0.3, 0.4, 0.5]
-    fps_female = [0, 0.1, 0.2, 0.3, 0.4, 0.5]
-    fns_female = [0, 0.1, 0.2, 0.3, 0.4, 0.5]
+    fps_male = [0.15, 0.20, 0.24, 0.25, 0.26, 0.30, 0.35]
+    fns_male = [0.15, 0.20, 0.24, 0.25, 0.26, 0.30, 0.35]
+    fps_female = [0.15, 0.20, 0.24, 0.25, 0.26, 0.30, 0.35]
+    fns_female = [0.15, 0.20, 0.24, 0.25, 0.26, 0.30, 0.35]
 
     error_rates = []
     for fp_male in fps_male:
diff --git a/results/0001/Backward error rate.pdf b/results/0001/Backward error rate.pdf
index 243d0ac..27733f8 100644
Binary files a/results/0001/Backward error rate.pdf and b/results/0001/Backward error rate.pdf differ
diff --git a/results/0001/Backward improvement.pdf b/results/0001/Backward improvement.pdf
index 82a8a00..9de55b1 100644
Binary files a/results/0001/Backward improvement.pdf and b/results/0001/Backward improvement.pdf differ
diff --git a/results/0001/Baseline error rate.pdf b/results/0001/Baseline error rate.pdf
index 0b530f1..ac7b31b 100644
Binary files a/results/0001/Baseline error rate.pdf and b/results/0001/Baseline error rate.pdf differ
diff --git a/results/0001/Forward error rate.pdf b/results/0001/Forward error rate.pdf
index 53344a8..3b8aefb 100644
Binary files a/results/0001/Forward error rate.pdf and b/results/0001/Forward error rate.pdf differ
diff --git a/results/0001/Forward improvement.pdf b/results/0001/Forward improvement.pdf
index 883c190..4897cdf 100644
Binary files a/results/0001/Forward improvement.pdf and b/results/0001/Forward improvement.pdf differ
